int __cdecl sub_401B70(char *cp, int a2, u_short hostshort)
{
  SOCKET v3; // eax
  SOCKET v4; // esi
  char v5; // bl
  char v7; // [esp+Fh] [ebp-411h]
  struct sockaddr name; // [esp+10h] [ebp-410h] BYREF
  char buf[1021]; // [esp+20h] [ebp-400h] BYREF
  __int16 v10; // [esp+41Dh] [ebp-3h]
  char v11; // [esp+41Fh] [ebp-1h]

  memset(buf, 0, sizeof(buf));
  name.sa_family = 2;
  v10 = 0;
  v11 = 0;
  *(_DWORD *)&name.sa_data[2] = inet_addr(cp);
  *(_WORD *)name.sa_data = htons(hostshort);
  v3 = socket(2, 1, 0);
  v4 = v3;
  if ( v3 != -1 )
  {
    if ( connect(v3, &name, 16) != -1
      && send(v4, byte_42E544, 137, 0) != -1
      && recv(v4, buf, 1024, 0) != -1
      && send(v4, byte_42E5D0, 140, 0) != -1
      && recv(v4, buf, 1024, 0) != -1 )
    {
      v5 = buf[32];
      byte_42E67C = buf[32];
      v7 = buf[33];
      byte_42E67D = buf[33];
      if ( send(v4, byte_42E65C, 96, 0) != -1 && recv(v4, buf, 1024, 0) != -1 )
      {
        byte_42E6D8 = buf[28];
        byte_42E6D9 = buf[29];
        byte_42E6DC = v5;
        byte_42E6DD = v7;
        if ( send(v4, byte_42E6BC, 82, 0) != -1 && recv(v4, buf, 1024, 0) != -1 && buf[34] == 81 )
        {
          if ( a2
            || (byte_42E6DE = 66,
                byte_42E6ED = 14,
                byte_42E6EE = 105,
                byte_42E6EF = 0,
                byte_42E6F0 = 0,
                send(v4, byte_42E6BC, 82, 0) != -1)
            && recv(v4, buf, 1024, 0) != -1 )
          {
            closesocket(v4);
            return 1;
          }
        }
      }
    }
    closesocket(v4);
  }
  return 0;
}